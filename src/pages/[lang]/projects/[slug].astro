---
import SiteLayout from "../../../layouts/SiteLayout.astro";
import { allLangs as LANGS, isLang, type Lang } from "../../../i18n/config";
import { t } from "../../../i18n/ui";
import { projects } from "../../../data/projects.js";
import GitHubIssuesLakehouse from "../../../components/projects/GitHubIssuesLakehouse.astro";

export function getStaticPaths() {
  return LANGS.flatMap((lang) =>
    projects.map((p) => ({ params: { lang, slug: p.slug } }))
  );
}

const { lang: rawLang, slug } = Astro.params;
const lang = (isLang(rawLang ?? "") ? rawLang : "en") as Lang;

const project = projects.find((p) => p.slug === slug);
if (!project) throw new Error("Project not found: " + slug);

const title = project.title[lang];
const isLakehouse = project.slug === "github-issues-lakehouse";
---
<SiteLayout lang={lang} title={`${title} — ${t(lang, "site_title")}`}>
  <div style="margin-bottom:14px;">
    <a class="btn" href={`/${lang}/projects/`}>← {t(lang, "projects_title")}</a>
  </div>

  {isLakehouse ? (
    <GitHubIssuesLakehouse lang={lang} project={project} />
  ) : (
    <section class="card" style="padding:22px;">
      <h1 style="margin:0 0 10px; font-size:28px;">{title}</h1>
      <p style="margin:0; opacity:.8; max-width:80ch; line-height:1.5;">
        {project.summary[lang]}
      </p>

      <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn" href={project.links.repo} target="_blank" rel="noreferrer">
          {lang === "fr" ? "Ouvrir le repo" : "Open repository"}
        </a>
        {project.links.demo
          ? <a class="btn" href={project.links.demo} target="_blank" rel="noreferrer">
              {lang === "fr" ? "Voir la démo" : "View demo"}
            </a>
          : null}
      </div>
    </section>
  )}
</SiteLayout>
